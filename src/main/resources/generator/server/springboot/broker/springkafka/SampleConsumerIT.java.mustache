package {{packageName}}.sample.infrastructure.primary.kafka.consumer;

import static org.awaitility.Awaitility.await;

import java.time.Duration;
import java.util.concurrent.TimeUnit;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import {{packageName}}.IntegrationTest;
import {{packageName}}.sample.infrastructure.secondary.kafka.producer.SampleProducer;

@IntegrationTest
class SampleConsumerIT {

  @Autowired
  private SampleProducer sampleProducer;

  @Autowired
  private SampleConsumer sampleConsumer;

  @Test
  void shouldConsumeMessage() {
    final String messageToSend = "sample";
    sampleProducer.send(messageToSend);

    // Wait for message to be consumed
    await()
      .atMost(Duration.ofSeconds(10))
      .pollDelay(Duration.ofMillis(100))
      .untilAsserted(() -> {
        // Message should be consumed without exceptions
        // You may want to add a counter in the consumer to verify message was processed
      });
  }
}
